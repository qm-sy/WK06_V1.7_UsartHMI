C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/25/2025 21:23:37 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE POWER_CRL
OBJECT MODULE PLACED IN ..\Output\hex\power_crl.obj
COMPILER INVOKED BY: D:\APP\Keil_STM32\C51\BIN\C51.EXE ..\BSP\Src\power_crl.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\B
                    -SP\Inc;..\Core\Inc;..\Drivers;..\Emembed\Inc;..\Middlewares;..\SYSTEM\Inc) DEBUG OBJECTEXTEND PRINT(.\Listings\power_crl
                    -.lst) OBJECT(..\Output\hex\power_crl.obj)

line level    source

   1          #include "power_crl.h"
   2          
   3          AC_220 ac_220;
   4          
   5          /**
   6           * @brief       ç§»ç›¸è§¦å‘è°ƒç”¨ç»“æ„ä½“åˆå§‹åŒ–
   7           *
   8           * @param   
   9           *
  10           * @return  void
  11          **/
  12          void Power_Statu_Init( void )
  13          {
  14   1          ac_220.zero_flag  = 0;
  15   1          ac_220.channel1_flag = 0;
  16   1          ac_220.channel2_flag = 0;
  17   1          ac_220.channel3_flag = 0;
  18   1          AC_Out1 = AC_Out2 = AC_Out3 = 1;
  19   1      }
  20          
  21          /**
  22           * @brief       å¤–éƒ¨ä¸­æ–­0ä¸­æ–­å¤„ç†å‡½æ•°
  23           *
  24           * @param   
  25           *
  26           * @return  void
  27          **/
  28          void INT0_ISR( void ) interrupt 0
  29          {
  30   1          /* 1, æ£€æµ‹åˆ°å¤–éƒ¨ä¸­æ–­åï¼Œç­‰å¾…THL\TLIåè§¦å‘TIM1ä¸­æ–­       */
  31   1          TL1 = ac_220.time_delay;                            
  32   1              TH1 = ac_220.time_delay >> 8;                           
  33   1      
  34   1          ac_220.zero_flag = 1;
  35   1      
  36   1          /* 2, å®šæ—¶å™¨1å¼€å§‹è®¡æ—¶ï¼Œæ‰“å¼€TIM1ä¸­æ–­                     */
  37   1          TR1 = 1;                                 
  38   1          ET1 = 1; 
  39   1      }
  40          
  41          /**
  42           * @brief       Timer1ä¸­æ–­å¤„ç†å‡½æ•°
  43           *
  44           * @param   
  45           *
  46           * @return  void
  47          **/
  48          void Tim1_ISR( void ) interrupt 3   //1ms
  49          {
  50   1          /* 1, ä¸­æ–­è§¦å‘åï¼Œpower_chç”µå¹³ ç”±é«˜ç”µå¹³å˜ä¸ºä½ç”µå¹³           */
  51   1          if( ac_220.zero_flag == 1 )
  52   1          {
  53   2              ac_220.zero_flag = 0;
C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/25/2025 21:23:37 PAGE 2   

  54   2              if(ac_220.channel1_flag == 1)
  55   2              {
  56   3                  AC_Out1 = 0;
  57   3              }
  58   2              if(ac_220.channel2_flag == 1)
  59   2              {
  60   3                  AC_Out2 = 0;
  61   3              }
  62   2              if(ac_220.channel3_flag == 1)
  63   2              {
  64   3                  AC_Out3 = 0;
  65   3              }
  66   2      
  67   2               /* 2, è®¾ç½®ä¸‹ä¸€æ¬¡Timer1ä¸­æ–­è§¦å‘æ‰€éœ€æ—¶é—´ï¼Œå³è„‰å†²æ—¶é—´       */
  68   2              TL1 = 0xF7;                             
  69   2              TH1 = 0xFF;                             
  70   2          }else
  71   1          {
  72   2              /* 3, ä¸‹ä¸€æ¬¡è¿›å…¥Timer1ä¸­æ–­ï¼Œpower_chç”µå¹³ ç”±ä½ç”µå¹³å˜ä¸ºé«˜ç”µå¹³ï¼Œå®Œæˆä¸€æ¬¡10usè
             -„‰å†²ï¼Œå³æ–©æ³¢*/
  73   2              AC_Out1 = AC_Out2 = AC_Out3 = 1;
  74   2      
  75   2              /* 4, å®šæ—¶å™¨1åœæ­¢è®¡æ—¶ï¼Œå…³é—­TIM1ä¸­æ–­ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¤–éƒ¨ä¸­æ–­     */
  76   2              TR1 = 0;                                    
  77   2              ET1 = 0; 
  78   2          }
  79   1      }
  80          
  81          /**
  82           * @brief       220Vè¾“å‡ºåŠŸç‡æ§åˆ¶å‡½æ•° 
  83           *
  84           * @param   power_levelï¼šè¾“å‡ºåŠŸç‡ç™¾åˆ†æ¯”  0%~100%
  85           *
  86           * @return  void
  87          **/
  88          void AC_220V_out( uint8_t power_level )
  89          {
  90   1          ac_220.time_delay = 58000 + 75*power_level;
  91   1      }
  92          
  93          
  94          /**
  95           * @brief       24V cirå¼€å…³æ§åˆ¶å‡½æ•°
  96           *
  97           * @param   on_offï¼š0ï¼šå…³é—­ 1ï¼šå¼€å¯
  98           *
  99           * @return  void
 100          **/
 101          void DC_24V_out1( uint8_t on_off )
 102          {
 103   1          if( on_off == 1 )
 104   1          {
 105   2              DC_24V_2 = 0;
 106   2          }else
 107   1          {
 108   2              DC_24V_2 = 1;
 109   2          }
 110   1      }
 111          
 112          /**
 113           * @brief       24V cirå¼€å…³æ§åˆ¶å‡½æ•°
 114           *
C51 COMPILER V9.60.7.0   POWER_CRL                                                         02/25/2025 21:23:37 PAGE 3   

 115           * @param   on_offï¼š0ï¼šå…³é—­ 1ï¼šå¼€å¯
 116           *
 117           * @return  void
 118          **/
 119          void DC_24V_out2( uint8_t on_off )
 120          {
 121   1          if( on_off == 1 )
 122   1          {
 123   2              DC_24V_2 = 0;
 124   2          }else
 125   1          {
 126   2              DC_24V_2 = 1;
 127   2          }
 128   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    177    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
